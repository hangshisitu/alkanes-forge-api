import AlkanesService from "./service/AlkanesService.js";
import MarketService from "./service/MarketService.js";
import * as bitcoin from "bitcoinjs-lib";
import PsbtUtil from "./utils/PsbtUtil.js";
import BigNumber from "bignumber.js";
import config from "./conf/config.js";
import MempoolUtil from "./utils/MempoolUtil.js";
import BaseService from "./service/BaseService.js";
import UnisatAPI from "./lib/UnisatAPI.js";

const assetAddress = 'bc1pnydp9t3epqe2ljtmy4m6n6wa6nzcxcfr25nc656xkgc2x82kufgq8mwgsr';
const assetPublicKey = '034fee79e4f2401b558727527b6e3ac8753772c184e1fd05a9948a93412af552ad';
const fundAddress = 'bc1qa0n0vfqzxmyjj5wyw4qhmu5q9nvc54sstg2wmq';
const fundPublicKey = '021f5115cc6c98b12db4832b8490e1afbbe29664ac3bb1c575153f6c70ead7ed1c';

// const assetUtxo = {
//     txid: '0c58a7a3b88ff2ca7043c092373437923822a536dd0346f11b27c426ec8356c7',
//     vout: 0,
//     value: 330,
//     address: 'bc1qxd530rj275mwrh7sdtvqw5zg7kdhjgluv33cqf'
// }
// const unsignedListingPsbt = await MarketService.genUnsignedListing(assetUtxo, 'bc1qxd530rj275mwrh7sdtvqw5zg7kdhjgluv33cqf', '034015870024aac759c6089e4d2cc00e338608f4ff819f4433b42040e5a4cadce7', 'bc1qxd530rj275mwrh7sdtvqw5zg7kdhjgluv33cqf', 10000);
// console.log(unsignedListingPsbt);

// const signedListingPsbt = '70736274ff0100520200000001c75683ec26c4271bf14603dd36a522389237343792c04370caf28fb8a3a7580c0000000000ffffffff0110270000000000001600143369178e4af536e1dfd06ad8075048f59b7923fc000000000001011f4a010000000000001600143369178e4af536e1dfd06ad8075048f59b7923fc01086b024730440220078eb4e1753a59ab32da3f2f7b43189f40bfa8e7941ccdc9022c7df61f27ff37022034c4aa219995ec91c9e2bbddaf10ce4031244f74ca077a9866f1500ac504a61c8321034015870024aac759c6089e4d2cc00e338608f4ff819f4433b42040e5a4cadce70000';
// const psbt = await MarketService.genUnsignedBuying('2:28', 100000000, signedListingPsbt, fundAddress, fundPublicKey, assetAddress, 1);
// console.log(psbt)

// const psbt = await AlkanesService.transferToken('bc1qxd530rj275mwrh7sdtvqw5zg7kdhjgluv33cqf', '034015870024aac759c6089e4d2cc00e338608f4ff819f4433b42040e5a4cadce7', 'bc1qxd530rj275mwrh7sdtvqw5zg7kdhjgluv33cqf', assetAddress, '2:28', 69999999450000000, 1);
// console.log(psbt);

//100000000+550000000
// const alkanesList = await AlkanesService.getAlkanesByAddress('bc1q2rtajjjpjqnaawac3vaknn7xnp9assrayndulz');
// console.log(alkanesList);

// const alkanes = await AlkanesService.getAlkanesByUtxo({
//     txid: 'd60814e0d3b337bbe8d5d92aebac5509eec4a84e7d17a69dcfcef85bc7cd9453',
//     vout: 0
// });
// console.log(alkanes);

// console.log(Buffer.from('74da5510b93275603e40b0a39f11ad2f461c37a50bf9662bdf7ecf28a785fea8', 'hex').reverse().toString('hex'))
// console.log(new BigNumber('0xd529ae7dbdaa80').toNumber());
// console.log(new BigNumber('0x20c85580').toNumber());

// 查询代币信息
// const alkanes = await AlkanesService.getAlkanesById('2:102');
// console.log(alkanes);

//查询地址下余额信息
// const alkanesList = await AlkanesService.getAlkanesByAddress('bc1pv8k5hykqmssuvgq4txp5es4ddvswrcwpaxjzrppalfq44dyndx6s2chkx8');
// console.log(alkanesList);

// 查询持有代币的utxo列表
// const alkanesList = await AlkanesService.getAlkanesByTarget('bc1qxd530rj275mwrh7sdtvqw5zg7kdhjgluv33cqf', '2:28', 5 * 100000000 * 1e8);
// console.log(alkanesList);

// 查询单个utxo的余额信息
// const alkanesList = await AlkanesService.getAlkanesByUtxo({txid: 'b0088ab54452c4f25542cf1bcb33b056ca5d8a04a492ee95b9f0c51c5ce55007', vout: 0});
// console.log(alkanesList);

const balanceInfo = await BaseService.getBalanceByMempool('bc1qema49xtppluxx46gx5ufpuajt3h5aagztkayvs');
console.log(balanceInfo);

// const script = AlkanesService.getMintProtostone('2:0,2:61');
// console.log(script.toString('hex'))

// const txid = await UnisatAPI.unisatPush('70736274ff0100fdcb04020000001120e35186c256341eb89b40d6d16d14cd56c6eda1de8c21ba813f701209f4c9b90100000000ffffffff22a665562cec520d4c2606215496cadb89aac3cffd6dcc72d84fe1c1367180f80000000000ffffffff7078a3dc8236d32ac27aa0ca8bdec5da8e251df88a6f7705358c550c659db0390000000000ffffffff31f84d8120458555997c208e15ded6bfd987061dd7ffd1c592f090dbe3329f300000000000ffffffffc462e021ed4c2a973f3b9c0846596330d3068605194d205023b75e30d419e3460000000000ffffffffe8a084acd62042ec3516c019293a440290bb0a45b6984520dadf9402fb7626420000000000ffffffffc97afc7a375751e0649fde1f8251c5c2b49e36686924744bf13e223d4f6a0e430000000000ffffffff1d25079acd24ee2762d94c133701eb5bc8b8ff95e8fe754bc78a99ba36d0744a0000000000ffffffffa5741b0a34348658072026a507068d68af2966bf2961122397c9c806771073530000000000ffffffff617f4ca475cf9b36b20b52e5195c61ae0ee000749d3aee1707aaab7dbed6e27a0000000000ffffffff9019c02a3217c75d15d75c02d41314c6e68f634c8352bd62dc24b4cd18752b530000000000ffffffffa7be6b975efc89cb3f84534a91782c83880ba76f6a37ce12f20b571483121d500000000000ffffffff8efe11f7e21c9eedbe0c71580cc75aed80c8e776a179931614bbd18111064e710000000000ffffffff25a54d9905e488fda0491c3978c6460c3bc33dea1bb384949bc067e9953193370000000000ffffffff526e14afb4fa7fdfb01738a77755ae1a7b8a3abe8fd72b86adf6bb3cfd23fb7b1300000000ffffffff526e14afb4fa7fdfb01738a77755ae1a7b8a3abe8fd72b86adf6bb3cfd23fb7b1200000000ffffffff526e14afb4fa7fdfb01738a77755ae1a7b8a3abe8fd72b86adf6bb3cfd23fb7b1100000000ffffffff11220200000000000016001450d7d94a419027debbb88b3b69cfc6984bd8407d5327000000000000160014caf0980d9241234e5a5a698731e679b69fa9bd425327000000000000160014caf0980d9241234e5a5a698731e679b69fa9bd425327000000000000160014caf0980d9241234e5a5a698731e679b69fa9bd42b7270000000000001600142a8d5a04974b316e38d89c5a1433b1a363c11fc5b7270000000000001600142a8d5a04974b316e38d89c5a1433b1a363c11fc5b7270000000000001600142a8d5a04974b316e38d89c5a1433b1a363c11fc5b7270000000000001600142a8d5a04974b316e38d89c5a1433b1a363c11fc55327000000000000160014caf0980d9241234e5a5a698731e679b69fa9bd425327000000000000160014caf0980d9241234e5a5a698731e679b69fa9bd425327000000000000160014caf0980d9241234e5a5a698731e679b69fa9bd42c325000000000000160014ec4f596864031aa84350c8374704261325f423d95327000000000000160014caf0980d9241234e5a5a698731e679b69fa9bd425327000000000000160014caf0980d9241234e5a5a698731e679b69fa9bd4200000000000000000f6a5d0cff7f8192ec82d08b80808220d2210000000000001600149462cc9be54725cca2afca6fe82bcd4c54bbccd313d300000000000016001450d7d94a419027debbb88b3b69cfc6984bd8407d000000000001011f59c100000000000016001450d7d94a419027debbb88b3b69cfc6984bd8407d01086b0247304402206ae0586423bcd9afd2f606649ce48689fd750ff68d7559a86a5b371052715b81022023bc16dd30fc836ad65252a983bcec65f7d72b3a6f7e9328bc8538e80b0491940121020c156fd0fd5709300577434d1de51a9f8915368aabfaec61f898a174c35427350001012b2202000000000000225120c0d554ab88db66230517c6b34fb618ca687d18d43117be30b70e710b89e28a8001030483000000011720e2e6c5a10ce94d93a58d3ce24ab00f06e57a0c03204606663537f9c6814af0280001012b2202000000000000225120c0d554ab88db66230517c6b34fb618ca687d18d43117be30b70e710b89e28a8001030483000000011720e2e6c5a10ce94d93a58d3ce24ab00f06e57a0c03204606663537f9c6814af0280001012b2202000000000000225120c0d554ab88db66230517c6b34fb618ca687d18d43117be30b70e710b89e28a8001030483000000011720e2e6c5a10ce94d93a58d3ce24ab00f06e57a0c03204606663537f9c6814af0280001012b22020000000000002251207974fcaec380c25a9203c593157db7c5da2fcc6f43cc5b3eb2c5a2a24afb7fb7010843014199f7e8647ff5e83d611aafd3f4758f06ba953e7d3d2f2eb647fbd59cfdeaae57804a8d5d4b79cb1976060ec61b4b97e04c94cbe646769766a4dc81594e9253a1830001012b22020000000000002251207974fcaec380c25a9203c593157db7c5da2fcc6f43cc5b3eb2c5a2a24afb7fb70108430141036c6fe5613201e4e58240e77c30491384f065286215d4e6e70f7ae062c947c65e6fc253e0ea05862496d7b4809a0f2ff58a6174698fcf275da7d0a9a17ccb57830001012b22020000000000002251207974fcaec380c25a9203c593157db7c5da2fcc6f43cc5b3eb2c5a2a24afb7fb7010843014181a89da1c51f41c0162c580970af6aaecb5180fdb2d1ee0f8b23c872c2bd5dbd08bd9824be913097ba0ee981064437e39519614a827e320868fc94ab99f2b273830001012b22020000000000002251207974fcaec380c25a9203c593157db7c5da2fcc6f43cc5b3eb2c5a2a24afb7fb7010843014115adec260369d7b8b649184725184fd177cf0aa3fd51dde95f85eea6d5ba5c0a4dc8e039e8d6d2bb53e28619d37b24532d7ca463e7f0db27c7c5451e89ccfcb4830001012b2202000000000000225120c0d554ab88db66230517c6b34fb618ca687d18d43117be30b70e710b89e28a8001030483000000011720e2e6c5a10ce94d93a58d3ce24ab00f06e57a0c03204606663537f9c6814af0280001012b2202000000000000225120c0d554ab88db66230517c6b34fb618ca687d18d43117be30b70e710b89e28a8001030483000000011720e2e6c5a10ce94d93a58d3ce24ab00f06e57a0c03204606663537f9c6814af0280001012b2202000000000000225120c0d554ab88db66230517c6b34fb618ca687d18d43117be30b70e710b89e28a8001030483000000011720e2e6c5a10ce94d93a58d3ce24ab00f06e57a0c03204606663537f9c6814af0280001012b22020000000000002251201badd66f1add47e24850dd81bdceb70e8db818a8086c4465d89e6584aeea28ab01084301417de750cd97faf05d89bdf92d8e058ebbfea59a72239a0eabeb2e6ecdfe678d71f69fe8b1f627fdfdaab2d1a470da537af471300c4c4abb49765ca8644ff5d623830001012b2202000000000000225120c0d554ab88db66230517c6b34fb618ca687d18d43117be30b70e710b89e28a8001030483000000011720e2e6c5a10ce94d93a58d3ce24ab00f06e57a0c03204606663537f9c6814af0280001012b2202000000000000225120c0d554ab88db66230517c6b34fb618ca687d18d43117be30b70e710b89e28a8001030483000000011720e2e6c5a10ce94d93a58d3ce24ab00f06e57a0c03204606663537f9c6814af0280001011f43b500000000000016001450d7d94a419027debbb88b3b69cfc6984bd8407d01086b0247304402203b7c82d120e1ee193f1f569c3ca25fe1dcdf0e5936bf68ca07e10f9ef39d7122022058d96b353835a9efc5953bd60f794e6dece8198ead32bcf08ac52bd7ff5669460121020c156fd0fd5709300577434d1de51a9f8915368aabfaec61f898a174c35427350001011f43b500000000000016001450d7d94a419027debbb88b3b69cfc6984bd8407d01086c024830450221009be7d39ba25dcd2b083a66e7e40a7ed78290e32e707deb32a36bfdeda0c6e44b02205f5aa6d1e88c64c02b372a5cc58f1feb225ebab23349656cf86d62beb47476fb0121020c156fd0fd5709300577434d1de51a9f8915368aabfaec61f898a174c35427350001011f43b500000000000016001450d7d94a419027debbb88b3b69cfc6984bd8407d01086b0247304402202b31a7e2965414853ad5a4b458265497b9dc13172a4524282e13103155cb98a902203ba2d2258fdd6c995d0d402495adc293cc90d3684be5b1e0b35048cf7e4d150d0121020c156fd0fd5709300577434d1de51a9f8915368aabfaec61f898a174c3542735000000000000000000000000000000000000')
// console.log(txid);